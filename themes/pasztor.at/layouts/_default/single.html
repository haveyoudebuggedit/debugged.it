{{ define "css" }}
    {{ partial "scss" (dict "file" "scss/single.scss") }}
    {{ if in .Content "<pre class=\"chroma\">" }}
        {{ partial "scss" (dict "file" "scss/code.scss") }}
    {{ end }}
    {{ if (isset .Params "mp3") }}
        {{ partial "scss" (dict "file" "scss/audio.scss") }}
    {{ end }}
{{ end }}

{{ define "main" }}
    {{ if (isset .Params "mp3") }}
        <input type="checkbox" class="audio-toggle" value="1" id="player" />
        <div class="audio-overlay" role="dialog" aria-describedby="dialog-title">
            <label for="player" class="audio-overlay-close">&nbsp;</label>
            <div class="audio-player-wrapper">
                <div class="audio-player">
                    <header>
                        <h2 id="listen-title">Listen to this post</h2>
                        <label class="close" for="player" aria-label="Close">&times;</label>
                    </header>
                    <main>
                        <audio controls>
                            <source src="{{ (resources.Get .Params.mp3).RelPermalink }}" />
                            Your browser does not seem to support MP# playback.
                        </audio>
                    </main>
                    <footer>
                        <a class="download" target="_blank" download type="audio/mpeg" href="{{ (resources.Get .Params.mp3).RelPermalink }}">Download MP3</a>
                    </footer>
                </div>
            </div>
        </div>
    {{ end }}
    <article class="text{{ if not $.PublishDate}} text--simple{{ end }}"{{ if $.PublishDate }} itemscope itemtype="https://schema.org/BlogPosting"{{ end }}>
        {{ if $.PublishDate }}
        {{ with .Params.images }}<meta itemprop="image" content="{{ (resources.Get (index . 0)).Permalink }}" />{{ end }}
        <meta itemprop="mainEntityOfPage" content="{{ .Permalink }}" />
        <meta itemprop="keywords" content="{{ delimit .Params.tags ", " }}" />
        {{ end }}

        <h1{{ if $.PublishDate }} itemprop="name headline"{{ end }}>{{ .Title }}</h1>
        {{ if $.PublishDate }}
        <div class="meta">
            <time datetime="{{ $.PublishDate }}"{{ if $.PublishDate }} itemprop="datePublished"{{ end }}>
                <span class="line">{{ $.PublishDate.Format "Jun 1, 2006" }}</span>
                <span class="calendar">
                    <span class="day">{{ $.PublishDate.Day}}</span>
                    <span class="month-year">{{ substr $.PublishDate.Month 0 3 }} {{ $.PublishDate.Year}}</span>
                </span>
            </time>
            {{ if (isset .Params "mp3") }}
                <label for="player" class="listen">ðŸŽ§ Listen</label>
            {{ end }}
        </div>
        {{ end }}
        <div{{ if $.PublishDate }} itemprop="articleBody"{{ end }} class="body">
            {{ .Content }}
        </div>
        {{ if (isset .Params "authors")}}
            {{ range $key, $author := .Params.authors }}
                <div class="bio" itemprop="author" itemscope itemtype="https://schema.org/Person">
                {{- with index $.Site.Data.authors $author }}
                    <h2 itemprop="name">{{ .fullname }}</h2>
                    <img class="avatar" src="{{ ((resources.Get .avatar).Resize "512x 90 jpg").RelPermalink }}" alt="" />
                    <p>{{ .bio }}</p>
                    <nav class="readmore">
                        <a href="/blog">Read more by {{ .name }} &raquo;</a>
                    </nav>
                {{ end }}
                </div>
            {{ end }}
        {{ end }}
    </article>
{{ end }}
